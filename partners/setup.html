<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Partner Setup</title>
  <link rel="stylesheet" href="/partners/styles.css" />
</head>
<body>
  <main class="container">
    <h1>Partner Setup</h1>

    <form id="partner-form">
      <label>
        Slug (required)
        <input id="slug" name="slug" placeholder="e.g. acme-co" required />
      </label>

      <label>
        Partner name
        <input id="name" name="name" placeholder="e.g. Acme Co" />
      </label>

      <label>
        Contact email
        <input id="email" name="email" type="email" placeholder="name@acme.com" />
      </label>

      <button type="submit">Save Partner</button>
    </form>

    <pre id="status" style="white-space:pre-wrap;margin-top:16px;"></pre>
  </main>

  <script>
    const statusEl = document.getElementById("status");

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    async function savePartnerToServer(partner) {
      const res = await fetch("/.netlify/functions/partner-save", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify(partner),
      });

      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data?.error || "Failed to save partner");
      return data; // { ok: true, slug: "..." }
    }

    document.getElementById("partner-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      setStatus("");

      const partner = {
        slug: document.getElementById("slug").value.trim(),
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
      };

      try {
        const saved = await savePartnerToServer(partner);
        setStatus(JSON.stringify(saved, null, 2));
        window.location.href = `/partners/store.html?slug=${encodeURIComponent(saved.slug)}`;
      } catch (err) {
        setStatus(String(err?.message || err));
        alert(err?.message || String(err));
      }
    });
  </script>
</body>
</html>
